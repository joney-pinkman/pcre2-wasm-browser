"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _libpcre = _interopRequireDefault(require("../../dist/libpcre2.js"))

var _assert = _interopRequireDefault(require("assert"))


var Buffer = require('buffer/').Buffer  // note: the trailing slash is important!


function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const utf16Decoder = new TextDecoder('utf-16');
let initialized = false;
const cfunc = {};
const ptrSym = Symbol('ptr');
const nametableSym = Symbol('nametable');
const patternSym = Symbol('pattern');
const PCRE2_NO_MATCH = -1;
const PCRE2_ERROR_NOMEMORY = -48;
const PCRE2_SUBSTITUTE_GLOBAL = 0x00000100;
const PCRE2_SUBSTITUTE_EXTENDED = 0x00000200;
const MAX_OUTPUT_BUFFER_SIZE = 1 * 1024 * 1024;

class PCRE {
  static async init() {
    await _libpcre.default.loaded;
    Object.assign(cfunc, {
      malloc(bytes) {
        return _libpcre.default._malloc(bytes);
      },

      free(ptr) {
        return _libpcre.default._free(ptr);
      },

      version: _libpcre.default.cwrap('version', 'number', ['number']),
      compile: _libpcre.default.cwrap('compile', 'number', ['array', 'number', 'string']),
      destroyCode: _libpcre.default.cwrap('destroyCode', null, ['number']),
      lastErrorMessage: _libpcre.default.cwrap('lastErrorMessage', 'number', ['number', 'number']),
      lastErrorOffset: _libpcre.default.cwrap('lastErrorOffset', 'number'),
      match: _libpcre.default.cwrap('match', 'number', ['number', 'array', 'number', 'number']),
      substitute: _libpcre.default.cwrap('substitute', 'number', ['number', 'array', 'number', 'number', 'number', 'number', 'array', 'number', 'number', 'number']),
      createMatchData: _libpcre.default.cwrap('createMatchData', 'number', ['number']),
      destroyMatchData: _libpcre.default.cwrap('destroyMatchData', null, ['number']),
      getOvectorCount: _libpcre.default.cwrap('getOvectorCount', 'number', ['number']),
      getOvectorPtr: _libpcre.default.cwrap('getOvectorPointer', 'number', ['number']),
      getCaptureCount: _libpcre.default.cwrap('getCaptureCount', 'number', ['number']),
      getMatchNameCount: _libpcre.default.cwrap('getMatchNameCount', 'number', ['number']),
      getMatchNameTableEntrySize: _libpcre.default.cwrap('getMatchNameTableEntrySize', 'number', ['number']),
      getMatchNameTable: _libpcre.default.cwrap('getMatchNameTable', 'number', ['number'])
    });
    initialized = true;
  }

  static version() {
    (0, _assert.default)(initialized);
    const len = cfunc.version(0);
    const ptr = allocateStringBuffer(len);
    cfunc.version(ptr);
    return copyAndFreeStringBuffer(ptr, len);
  }

  constructor(pattern, flags = '') {
    (0, _assert.default)(initialized);
    const patternBuffer = Buffer.from(pattern, 'utf16le');
    const ptr = cfunc.compile(patternBuffer, patternBuffer.length / 2, flags);

    if (ptr === 0) {
      const {
        errorMessage,
        offset
      } = this.getLastError();
      const err = new Error(errorMessage);
      err.offset = offset;
      throw err;
    }

    this[ptrSym] = ptr;
    this[patternSym] = pattern; // extract the nametable 

    const nameCount = this.getMatchNameCount();
    const entrySize = this.getMatchNameTableEntrySize();
    const tableBuf = this.getMatchNameTable();
    this[nametableSym] = convertNameTable(tableBuf, nameCount, entrySize);
  }

  destroy() {
    if (this[ptrSym] === 0) return;
    cfunc.destroyCode(this[ptrSym]);
    this[ptrSym] = 0;
  }

  getLastError() {
    const errMsgBufLen = 256;
    const errMsgBuf = allocateStringBuffer(errMsgBufLen);
    const actualErrMsgLen = cfunc.lastErrorMessage(errMsgBuf, errMsgBufLen);
    const errorMessage = copyAndFreeStringBuffer(errMsgBuf, actualErrMsgLen);
    const offset = cfunc.lastErrorOffset();
    return {
      errorMessage,
      offset
    };
  }

  createMatchData() {
    return cfunc.createMatchData(this[ptrSym]);
  }

  destroyMatchData(matchDataPtr) {
    cfunc.destroyMatchData(matchDataPtr);
  }

  exec(subject, options) {
    if (options) {
      return this.matchAll(subject);
    } else {
      return this.match(subject);
    }
  }

  match(subject, start) {
    (0, _assert.default)(this[ptrSym]);

    if (start >= subject.length) {
      return null;
    }

    const startOffset = start || 0;
    const subjectBuffer = Buffer.from(subject, 'utf16le');
    const matchDataPtr = this.createMatchData();
    const result = cfunc.match(this[ptrSym], subjectBuffer, subjectBuffer.length / 2, startOffset, matchDataPtr);

    if (result < 0) {
      this.destroyMatchData(matchDataPtr);

      if (result === PCRE2_NO_MATCH) {
        return null;
      } else {
        const msg = getPCRE2Error(result);
        const err = new Error(msg);
        err.code = result;
        throw err;
      }
    } // extract the matches from the pcre2_match_data block


    const matchCount = this.getOvectorCount(matchDataPtr);
    const vectorPtr = this.getOvectorPtr(matchDataPtr);
    const matches = convertOVector(subject, vectorPtr, matchCount); // merge in nametable entries

    const results = { ...matches
    };

    for (let i in matches) {
      if (i in this[nametableSym]) {
        const name = this[nametableSym][i];
        results[name] = matches[i];
        results[name].group = i;
        matches[i].name = name;
      }
    }

    this.destroyMatchData(matchDataPtr);
    results.length = matchCount;
    return results;
  }

  matchAll(subject) {
    let safety = 1000;
    let results = [];
    let iter;
    let start = 0;

    while ((iter = this.match(subject, start)) !== null) {
      results.push(iter);
      start = iter[0].end;
      safety--;
      (0, _assert.default)(safety > 0, 'safety limit exceeded');
    }

    return results;
  }

  substituteAll(subject, replacement) {
    return this.substitute(subject, replacement, 0, PCRE2_SUBSTITUTE_GLOBAL);
  }

  substitute(subject, replacement, startOffset, options) {
    (0, _assert.default)(this[ptrSym]);

    if (startOffset >= subject.length) {
      return null;
    }

    startOffset = startOffset || 0;
    options = options || 0;
    options = options | PCRE2_SUBSTITUTE_EXTENDED;
    const subjectBuffer = Buffer.from(subject, 'utf16le');
    const replacementBuffer = Buffer.from(replacement, 'utf16le');
    let factor = 1.5;

    for (;;) {
      const matchDataPtr = this.createMatchData(); // This size is in character units, not bytes

      const outputBufferSize = Math.trunc(subject.length * factor);

      if (outputBufferSize > MAX_OUTPUT_BUFFER_SIZE) {
        return PCRE2_ERROR_NOMEMORY;
      }

      const outputBuffer = allocateStringBuffer(outputBufferSize);
      const result = cfunc.substitute(this[ptrSym], subjectBuffer, subjectBuffer.length / 2, startOffset, matchDataPtr, options, replacementBuffer, replacementBuffer.length / 2, outputBuffer, outputBufferSize);

      if (result < 0) {
        this.destroyMatchData(matchDataPtr);

        if (result === PCRE2_ERROR_NOMEMORY) {
          cfunc.free(outputBuffer);
          factor *= 2;
          continue;
        } else {
          cfunc.free(outputBuffer);
          const msg = getPCRE2Error(result);
          const err = new Error(msg);
          err.code = result;
          throw err;
        }
      }

      return copyAndFreeStringBuffer(outputBuffer, result);
    }
  }

  getOvectorCount(matchDataPtr) {
    (0, _assert.default)(matchDataPtr);
    return cfunc.getOvectorCount(matchDataPtr);
  }

  getOvectorPtr(matchDataPtr) {
    (0, _assert.default)(matchDataPtr);
    return cfunc.getOvectorPtr(matchDataPtr);
  }

  getCaptureCount() {
    if (this[ptrSym] === 0) return;
    return cfunc.getCaptureCount(this[ptrSym]);
  }

  getMatchNameCount() {
    if (this[ptrSym] === 0) return;
    return cfunc.getMatchNameCount(this[ptrSym]);
  }

  getMatchNameTableEntrySize() {
    if (this[ptrSym] === 0) return;
    return cfunc.getMatchNameTableEntrySize(this[ptrSym]);
  }

  getMatchNameTable() {
    if (this[ptrSym] === 0) return;
    return cfunc.getMatchNameTable(this[ptrSym]);
  }

}

exports.default = PCRE;

function allocateStringBuffer(len) {
  return cfunc.malloc(len * 2);
}

function copyStringBuffer(ptr, len) {
  len = _libpcre.default.HEAPU16[ptr / 2 + (len - 1)] === 0 ? len - 1 : len;

  const encodedString = _libpcre.default.HEAP8.subarray(ptr, ptr + len * 2);

  return utf16Decoder.decode(encodedString);
}

function copyAndFreeStringBuffer(ptr, len) {
  const string = copyStringBuffer(ptr, len);
  cfunc.free(ptr);
  return string;
}

function convertOVector(subject, vectorPtr, vectorCount) {
  const table = [];

  for (let i = 0; i < vectorCount; i++) {
    let ptr = vectorPtr + i * 4 * 2;

    const start = _libpcre.default.getValue(ptr, 'i32', false);

    const end = _libpcre.default.getValue(ptr + 4, 'i32', false);

    const match = subject.substring(start, end);
    table.push({
      start,
      end,
      match
    });
  }

  return table;
}

function convertNameTable(nameTablePtr, entries, entrySize) {
  const table = {};

  for (let i = 0; i < entries; i++) {
    let ptr = nameTablePtr + entrySize * i * 2;

    const index = _libpcre.default.getValue(ptr, 'i16', false);

    const name = copyStringBuffer(ptr + 2, utf16lelen(ptr + 2));
    table[index] = name;
  }

  return table;
}

function utf16lelen(ptr) {
  let len = 0;

  while (_libpcre.default.getValue(ptr, 'i16', false) !== 0) {
    len++;
    ptr += 2;
  }

  return len;
}

const ERRORS = {
  "-1": "PCRE2_ERROR_NOMATCH",
  "-2": "PCRE2_ERROR_PARTIAL",
  "-3": "PCRE2_ERROR_UTF8_ERR1",
  "-4": "PCRE2_ERROR_UTF8_ERR2",
  "-5": "PCRE2_ERROR_UTF8_ERR3",
  "-6": "PCRE2_ERROR_UTF8_ERR4",
  "-7": "PCRE2_ERROR_UTF8_ERR5",
  "-8": "PCRE2_ERROR_UTF8_ERR6",
  "-9": "PCRE2_ERROR_UTF8_ERR7",
  "-10": "PCRE2_ERROR_UTF8_ERR8",
  "-11": "PCRE2_ERROR_UTF8_ERR9",
  "-12": "PCRE2_ERROR_UTF8_ERR10",
  "-13": "PCRE2_ERROR_UTF8_ERR11",
  "-14": "PCRE2_ERROR_UTF8_ERR12",
  "-15": "PCRE2_ERROR_UTF8_ERR13",
  "-16": "PCRE2_ERROR_UTF8_ERR14",
  "-17": "PCRE2_ERROR_UTF8_ERR15",
  "-18": "PCRE2_ERROR_UTF8_ERR16",
  "-19": "PCRE2_ERROR_UTF8_ERR17",
  "-20": "PCRE2_ERROR_UTF8_ERR18",
  "-21": "PCRE2_ERROR_UTF8_ERR19",
  "-22": "PCRE2_ERROR_UTF8_ERR20",
  "-23": "PCRE2_ERROR_UTF8_ERR21",
  "-24": "PCRE2_ERROR_UTF16_ERR1",
  "-25": "PCRE2_ERROR_UTF16_ERR2",
  "-26": "PCRE2_ERROR_UTF16_ERR3",
  "-27": "PCRE2_ERROR_UTF32_ERR1",
  "-28": "PCRE2_ERROR_UTF32_ERR2",
  "-29": "PCRE2_ERROR_BADDATA",
  "-30": "PCRE2_ERROR_MIXEDTABLES",
  "-31": "PCRE2_ERROR_BADMAGIC",
  "-32": "PCRE2_ERROR_BADMODE",
  "-33": "PCRE2_ERROR_BADOFFSET",
  "-34": "PCRE2_ERROR_BADOPTION",
  "-35": "PCRE2_ERROR_BADREPLACEMENT",
  "-36": "PCRE2_ERROR_BADUTFOFFSET",
  "-37": "PCRE2_ERROR_CALLOUT",
  "-38": "PCRE2_ERROR_DFA_BADRESTART",
  "-39": "PCRE2_ERROR_DFA_RECURSE",
  "-40": "PCRE2_ERROR_DFA_UCOND",
  "-41": "PCRE2_ERROR_DFA_UFUNC",
  "-42": "PCRE2_ERROR_DFA_UITEM",
  "-43": "PCRE2_ERROR_DFA_WSSIZE",
  "-44": "PCRE2_ERROR_INTERNAL",
  "-45": "PCRE2_ERROR_JIT_BADOPTION",
  "-46": "PCRE2_ERROR_JIT_STACKLIMIT",
  "-47": "PCRE2_ERROR_MATCHLIMIT",
  "-48": "PCRE2_ERROR_NOMEMORY",
  "-49": "PCRE2_ERROR_NOSUBSTRING",
  "-50": "PCRE2_ERROR_NOUNIQUESUBSTRING",
  "-51": "PCRE2_ERROR_NULL",
  "-52": "PCRE2_ERROR_RECURSELOOP",
  "-53": "PCRE2_ERROR_DEPTHLIMIT",
  "-54": "PCRE2_ERROR_UNAVAILABLE",
  "-55": "PCRE2_ERROR_UNSET",
  "-56": "PCRE2_ERROR_BADOFFSETLIMIT",
  "-57": "PCRE2_ERROR_BADREPESCAPE",
  "-58": "PCRE2_ERROR_REPMISSINGBRACE",
  "-59": "PCRE2_ERROR_BADSUBSTITUTION",
  "-60": "PCRE2_ERROR_BADSUBSPATTERN",
  "-61": "PCRE2_ERROR_TOOMANYREPLACE",
  "-62": "PCRE2_ERROR_BADSERIALIZEDDATA",
  "-63": "PCRE2_ERROR_HEAPLIMIT",
  "-64": "PCRE2_ERROR_CONVERT_SYNTAX",
  "-65": "PCRE2_ERROR_INTERNAL_DUPMATCH",
  "-66": "PCRE2_ERROR_DFA_UINVALID_UTF"
};

function getPCRE2Error(result) {
  const code = `${result}`;

  if (code in ERRORS) {
    return ERRORS[code];
  } else {
    return "UNKNOWN";
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvUENSRS5qcyJdLCJuYW1lcyI6WyJ1dGYxNkRlY29kZXIiLCJUZXh0RGVjb2RlciIsImluaXRpYWxpemVkIiwiY2Z1bmMiLCJwdHJTeW0iLCJTeW1ib2wiLCJuYW1ldGFibGVTeW0iLCJwYXR0ZXJuU3ltIiwiUENSRTJfTk9fTUFUQ0giLCJQQ1JFMl9FUlJPUl9OT01FTU9SWSIsIlBDUkUyX1NVQlNUSVRVVEVfR0xPQkFMIiwiUENSRTJfU1VCU1RJVFVURV9FWFRFTkRFRCIsIk1BWF9PVVRQVVRfQlVGRkVSX1NJWkUiLCJQQ1JFIiwiaW5pdCIsImxpYnBjcmUyIiwibG9hZGVkIiwiT2JqZWN0IiwiYXNzaWduIiwibWFsbG9jIiwiYnl0ZXMiLCJfbWFsbG9jIiwiZnJlZSIsInB0ciIsIl9mcmVlIiwidmVyc2lvbiIsImN3cmFwIiwiY29tcGlsZSIsImRlc3Ryb3lDb2RlIiwibGFzdEVycm9yTWVzc2FnZSIsImxhc3RFcnJvck9mZnNldCIsIm1hdGNoIiwic3Vic3RpdHV0ZSIsImNyZWF0ZU1hdGNoRGF0YSIsImRlc3Ryb3lNYXRjaERhdGEiLCJnZXRPdmVjdG9yQ291bnQiLCJnZXRPdmVjdG9yUHRyIiwiZ2V0Q2FwdHVyZUNvdW50IiwiZ2V0TWF0Y2hOYW1lQ291bnQiLCJnZXRNYXRjaE5hbWVUYWJsZUVudHJ5U2l6ZSIsImdldE1hdGNoTmFtZVRhYmxlIiwibGVuIiwiYWxsb2NhdGVTdHJpbmdCdWZmZXIiLCJjb3B5QW5kRnJlZVN0cmluZ0J1ZmZlciIsImNvbnN0cnVjdG9yIiwicGF0dGVybiIsImZsYWdzIiwicGF0dGVybkJ1ZmZlciIsIkJ1ZmZlciIsImZyb20iLCJsZW5ndGgiLCJlcnJvck1lc3NhZ2UiLCJvZmZzZXQiLCJnZXRMYXN0RXJyb3IiLCJlcnIiLCJFcnJvciIsIm5hbWVDb3VudCIsImVudHJ5U2l6ZSIsInRhYmxlQnVmIiwiY29udmVydE5hbWVUYWJsZSIsImRlc3Ryb3kiLCJlcnJNc2dCdWZMZW4iLCJlcnJNc2dCdWYiLCJhY3R1YWxFcnJNc2dMZW4iLCJtYXRjaERhdGFQdHIiLCJleGVjIiwic3ViamVjdCIsIm9wdGlvbnMiLCJtYXRjaEFsbCIsInN0YXJ0Iiwic3RhcnRPZmZzZXQiLCJzdWJqZWN0QnVmZmVyIiwicmVzdWx0IiwibXNnIiwiZ2V0UENSRTJFcnJvciIsImNvZGUiLCJtYXRjaENvdW50IiwidmVjdG9yUHRyIiwibWF0Y2hlcyIsImNvbnZlcnRPVmVjdG9yIiwicmVzdWx0cyIsImkiLCJuYW1lIiwiZ3JvdXAiLCJzYWZldHkiLCJpdGVyIiwicHVzaCIsImVuZCIsInN1YnN0aXR1dGVBbGwiLCJyZXBsYWNlbWVudCIsInJlcGxhY2VtZW50QnVmZmVyIiwiZmFjdG9yIiwib3V0cHV0QnVmZmVyU2l6ZSIsIk1hdGgiLCJ0cnVuYyIsIm91dHB1dEJ1ZmZlciIsImNvcHlTdHJpbmdCdWZmZXIiLCJIRUFQVTE2IiwiZW5jb2RlZFN0cmluZyIsIkhFQVA4Iiwic3ViYXJyYXkiLCJkZWNvZGUiLCJzdHJpbmciLCJ2ZWN0b3JDb3VudCIsInRhYmxlIiwiZ2V0VmFsdWUiLCJzdWJzdHJpbmciLCJuYW1lVGFibGVQdHIiLCJlbnRyaWVzIiwiaW5kZXgiLCJ1dGYxNmxlbGVuIiwiRVJST1JTIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxZQUFZLEdBQUcsSUFBSUMsaUJBQUosQ0FBZ0IsUUFBaEIsQ0FBckI7QUFDQSxJQUFJQyxXQUFXLEdBQUcsS0FBbEI7QUFDQSxNQUFNQyxLQUFLLEdBQUcsRUFBZDtBQUVBLE1BQU1DLE1BQU0sR0FBR0MsTUFBTSxDQUFDLEtBQUQsQ0FBckI7QUFDQSxNQUFNQyxZQUFZLEdBQUdELE1BQU0sQ0FBQyxXQUFELENBQTNCO0FBQ0EsTUFBTUUsVUFBVSxHQUFHRixNQUFNLENBQUMsU0FBRCxDQUF6QjtBQUVBLE1BQU1HLGNBQWMsR0FBRyxDQUFDLENBQXhCO0FBQ0EsTUFBTUMsb0JBQW9CLEdBQUcsQ0FBQyxFQUE5QjtBQUNBLE1BQU1DLHVCQUF1QixHQUFHLFVBQWhDO0FBQ0EsTUFBTUMseUJBQXlCLEdBQUcsVUFBbEM7QUFFQSxNQUFNQyxzQkFBc0IsR0FBRyxJQUFJLElBQUosR0FBVyxJQUExQzs7QUFFZSxNQUFNQyxJQUFOLENBQVc7QUFDeEIsZUFBYUMsSUFBYixHQUFvQjtBQUNsQixVQUFNQyxpQkFBU0MsTUFBZjtBQUVBQyxJQUFBQSxNQUFNLENBQUNDLE1BQVAsQ0FBY2YsS0FBZCxFQUFxQjtBQUNuQmdCLE1BQUFBLE1BQU0sQ0FBQ0MsS0FBRCxFQUFRO0FBQUUsZUFBT0wsaUJBQVNNLE9BQVQsQ0FBaUJELEtBQWpCLENBQVA7QUFBZ0MsT0FEN0I7O0FBRW5CRSxNQUFBQSxJQUFJLENBQUNDLEdBQUQsRUFBTTtBQUFFLGVBQU9SLGlCQUFTUyxLQUFULENBQWVELEdBQWYsQ0FBUDtBQUE0QixPQUZyQjs7QUFHbkJFLE1BQUFBLE9BQU8sRUFBRVYsaUJBQVNXLEtBQVQsQ0FBZSxTQUFmLEVBQTBCLFFBQTFCLEVBQW9DLENBQUMsUUFBRCxDQUFwQyxDQUhVO0FBSW5CQyxNQUFBQSxPQUFPLEVBQUVaLGlCQUFTVyxLQUFULENBQWUsU0FBZixFQUEwQixRQUExQixFQUFvQyxDQUFDLE9BQUQsRUFBVSxRQUFWLEVBQW9CLFFBQXBCLENBQXBDLENBSlU7QUFLbkJFLE1BQUFBLFdBQVcsRUFBRWIsaUJBQVNXLEtBQVQsQ0FBZSxhQUFmLEVBQThCLElBQTlCLEVBQW9DLENBQUMsUUFBRCxDQUFwQyxDQUxNO0FBTW5CRyxNQUFBQSxnQkFBZ0IsRUFBRWQsaUJBQVNXLEtBQVQsQ0FBZSxrQkFBZixFQUFtQyxRQUFuQyxFQUE2QyxDQUFDLFFBQUQsRUFBVyxRQUFYLENBQTdDLENBTkM7QUFPbkJJLE1BQUFBLGVBQWUsRUFBRWYsaUJBQVNXLEtBQVQsQ0FBZSxpQkFBZixFQUFrQyxRQUFsQyxDQVBFO0FBUW5CSyxNQUFBQSxLQUFLLEVBQUVoQixpQkFBU1csS0FBVCxDQUFlLE9BQWYsRUFBd0IsUUFBeEIsRUFBa0MsQ0FBQyxRQUFELEVBQVcsT0FBWCxFQUFvQixRQUFwQixFQUE4QixRQUE5QixDQUFsQyxDQVJZO0FBU25CTSxNQUFBQSxVQUFVLEVBQUVqQixpQkFBU1csS0FBVCxDQUFlLFlBQWYsRUFBNkIsUUFBN0IsRUFBdUMsQ0FBQyxRQUFELEVBQVcsT0FBWCxFQUFvQixRQUFwQixFQUE4QixRQUE5QixFQUF3QyxRQUF4QyxFQUFrRCxRQUFsRCxFQUE0RCxPQUE1RCxFQUFxRSxRQUFyRSxFQUErRSxRQUEvRSxFQUF5RixRQUF6RixDQUF2QyxDQVRPO0FBVW5CTyxNQUFBQSxlQUFlLEVBQUVsQixpQkFBU1csS0FBVCxDQUFlLGlCQUFmLEVBQWtDLFFBQWxDLEVBQTRDLENBQUMsUUFBRCxDQUE1QyxDQVZFO0FBV25CUSxNQUFBQSxnQkFBZ0IsRUFBRW5CLGlCQUFTVyxLQUFULENBQWUsa0JBQWYsRUFBbUMsSUFBbkMsRUFBeUMsQ0FBQyxRQUFELENBQXpDLENBWEM7QUFZbkJTLE1BQUFBLGVBQWUsRUFBRXBCLGlCQUFTVyxLQUFULENBQWUsaUJBQWYsRUFBa0MsUUFBbEMsRUFBNEMsQ0FBQyxRQUFELENBQTVDLENBWkU7QUFhbkJVLE1BQUFBLGFBQWEsRUFBRXJCLGlCQUFTVyxLQUFULENBQWUsbUJBQWYsRUFBb0MsUUFBcEMsRUFBOEMsQ0FBQyxRQUFELENBQTlDLENBYkk7QUFjbkJXLE1BQUFBLGVBQWUsRUFBRXRCLGlCQUFTVyxLQUFULENBQWUsaUJBQWYsRUFBa0MsUUFBbEMsRUFBNEMsQ0FBQyxRQUFELENBQTVDLENBZEU7QUFlbkJZLE1BQUFBLGlCQUFpQixFQUFFdkIsaUJBQVNXLEtBQVQsQ0FBZSxtQkFBZixFQUFvQyxRQUFwQyxFQUE4QyxDQUFDLFFBQUQsQ0FBOUMsQ0FmQTtBQWdCbkJhLE1BQUFBLDBCQUEwQixFQUFFeEIsaUJBQVNXLEtBQVQsQ0FBZSw0QkFBZixFQUE2QyxRQUE3QyxFQUF1RCxDQUFDLFFBQUQsQ0FBdkQsQ0FoQlQ7QUFpQm5CYyxNQUFBQSxpQkFBaUIsRUFBRXpCLGlCQUFTVyxLQUFULENBQWUsbUJBQWYsRUFBb0MsUUFBcEMsRUFBOEMsQ0FBQyxRQUFELENBQTlDO0FBakJBLEtBQXJCO0FBb0JBeEIsSUFBQUEsV0FBVyxHQUFHLElBQWQ7QUFDRDs7QUFFRCxTQUFPdUIsT0FBUCxHQUFpQjtBQUNmLHlCQUFPdkIsV0FBUDtBQUNBLFVBQU11QyxHQUFHLEdBQUd0QyxLQUFLLENBQUNzQixPQUFOLENBQWMsQ0FBZCxDQUFaO0FBQ0EsVUFBTUYsR0FBRyxHQUFHbUIsb0JBQW9CLENBQUNELEdBQUQsQ0FBaEM7QUFDQXRDLElBQUFBLEtBQUssQ0FBQ3NCLE9BQU4sQ0FBY0YsR0FBZDtBQUNBLFdBQU9vQix1QkFBdUIsQ0FBQ3BCLEdBQUQsRUFBTWtCLEdBQU4sQ0FBOUI7QUFDRDs7QUFFREcsRUFBQUEsV0FBVyxDQUFDQyxPQUFELEVBQVVDLEtBQUssR0FBRyxFQUFsQixFQUFzQjtBQUMvQix5QkFBTzVDLFdBQVA7QUFDQSxVQUFNNkMsYUFBYSxHQUFHQyxNQUFNLENBQUNDLElBQVAsQ0FBWUosT0FBWixFQUFxQixTQUFyQixDQUF0QjtBQUNBLFVBQU10QixHQUFHLEdBQUdwQixLQUFLLENBQUN3QixPQUFOLENBQWNvQixhQUFkLEVBQTZCQSxhQUFhLENBQUNHLE1BQWQsR0FBdUIsQ0FBcEQsRUFBdURKLEtBQXZELENBQVo7O0FBRUEsUUFBSXZCLEdBQUcsS0FBSyxDQUFaLEVBQWU7QUFDYixZQUFNO0FBQUU0QixRQUFBQSxZQUFGO0FBQWdCQyxRQUFBQTtBQUFoQixVQUEyQixLQUFLQyxZQUFMLEVBQWpDO0FBQ0EsWUFBTUMsR0FBRyxHQUFHLElBQUlDLEtBQUosQ0FBVUosWUFBVixDQUFaO0FBQ0FHLE1BQUFBLEdBQUcsQ0FBQ0YsTUFBSixHQUFhQSxNQUFiO0FBQ0EsWUFBTUUsR0FBTjtBQUNEOztBQUVELFNBQUtsRCxNQUFMLElBQWVtQixHQUFmO0FBQ0EsU0FBS2hCLFVBQUwsSUFBbUJzQyxPQUFuQixDQWIrQixDQWUvQjs7QUFDQSxVQUFNVyxTQUFTLEdBQUcsS0FBS2xCLGlCQUFMLEVBQWxCO0FBQ0EsVUFBTW1CLFNBQVMsR0FBRyxLQUFLbEIsMEJBQUwsRUFBbEI7QUFDQSxVQUFNbUIsUUFBUSxHQUFHLEtBQUtsQixpQkFBTCxFQUFqQjtBQUNBLFNBQUtsQyxZQUFMLElBQXFCcUQsZ0JBQWdCLENBQUNELFFBQUQsRUFBV0YsU0FBWCxFQUFzQkMsU0FBdEIsQ0FBckM7QUFDRDs7QUFFREcsRUFBQUEsT0FBTyxHQUFHO0FBQ1IsUUFBSSxLQUFLeEQsTUFBTCxNQUFpQixDQUFyQixFQUF3QjtBQUN4QkQsSUFBQUEsS0FBSyxDQUFDeUIsV0FBTixDQUFrQixLQUFLeEIsTUFBTCxDQUFsQjtBQUNBLFNBQUtBLE1BQUwsSUFBZSxDQUFmO0FBQ0Q7O0FBRURpRCxFQUFBQSxZQUFZLEdBQUc7QUFDYixVQUFNUSxZQUFZLEdBQUcsR0FBckI7QUFDQSxVQUFNQyxTQUFTLEdBQUdwQixvQkFBb0IsQ0FBQ21CLFlBQUQsQ0FBdEM7QUFDQSxVQUFNRSxlQUFlLEdBQUc1RCxLQUFLLENBQUMwQixnQkFBTixDQUF1QmlDLFNBQXZCLEVBQWtDRCxZQUFsQyxDQUF4QjtBQUNBLFVBQU1WLFlBQVksR0FBR1IsdUJBQXVCLENBQUNtQixTQUFELEVBQVlDLGVBQVosQ0FBNUM7QUFDQSxVQUFNWCxNQUFNLEdBQUdqRCxLQUFLLENBQUMyQixlQUFOLEVBQWY7QUFFQSxXQUFPO0FBQUVxQixNQUFBQSxZQUFGO0FBQWdCQyxNQUFBQTtBQUFoQixLQUFQO0FBQ0Q7O0FBRURuQixFQUFBQSxlQUFlLEdBQUc7QUFDaEIsV0FBTzlCLEtBQUssQ0FBQzhCLGVBQU4sQ0FBc0IsS0FBSzdCLE1BQUwsQ0FBdEIsQ0FBUDtBQUNEOztBQUVEOEIsRUFBQUEsZ0JBQWdCLENBQUM4QixZQUFELEVBQWU7QUFDN0I3RCxJQUFBQSxLQUFLLENBQUMrQixnQkFBTixDQUF1QjhCLFlBQXZCO0FBQ0Q7O0FBRURDLEVBQUFBLElBQUksQ0FBQ0MsT0FBRCxFQUFVQyxPQUFWLEVBQW1CO0FBQ3JCLFFBQUlBLE9BQUosRUFBYTtBQUNYLGFBQU8sS0FBS0MsUUFBTCxDQUFjRixPQUFkLENBQVA7QUFDRCxLQUZELE1BR0s7QUFDSCxhQUFPLEtBQUtuQyxLQUFMLENBQVdtQyxPQUFYLENBQVA7QUFDRDtBQUNGOztBQUVEbkMsRUFBQUEsS0FBSyxDQUFDbUMsT0FBRCxFQUFVRyxLQUFWLEVBQWlCO0FBQ3BCLHlCQUFPLEtBQUtqRSxNQUFMLENBQVA7O0FBRUEsUUFBSWlFLEtBQUssSUFBSUgsT0FBTyxDQUFDaEIsTUFBckIsRUFBNkI7QUFDM0IsYUFBTyxJQUFQO0FBQ0Q7O0FBRUQsVUFBTW9CLFdBQVcsR0FBR0QsS0FBSyxJQUFJLENBQTdCO0FBRUEsVUFBTUUsYUFBYSxHQUFHdkIsTUFBTSxDQUFDQyxJQUFQLENBQVlpQixPQUFaLEVBQXFCLFNBQXJCLENBQXRCO0FBRUEsVUFBTUYsWUFBWSxHQUFHLEtBQUsvQixlQUFMLEVBQXJCO0FBRUEsVUFBTXVDLE1BQU0sR0FBR3JFLEtBQUssQ0FBQzRCLEtBQU4sQ0FDYixLQUFLM0IsTUFBTCxDQURhLEVBRWJtRSxhQUZhLEVBR2JBLGFBQWEsQ0FBQ3JCLE1BQWQsR0FBdUIsQ0FIVixFQUlib0IsV0FKYSxFQUtiTixZQUxhLENBQWY7O0FBUUEsUUFBSVEsTUFBTSxHQUFHLENBQWIsRUFBZ0I7QUFDZCxXQUFLdEMsZ0JBQUwsQ0FBc0I4QixZQUF0Qjs7QUFFQSxVQUFJUSxNQUFNLEtBQUtoRSxjQUFmLEVBQStCO0FBQzdCLGVBQU8sSUFBUDtBQUNELE9BRkQsTUFHSztBQUNILGNBQU1pRSxHQUFHLEdBQUdDLGFBQWEsQ0FBQ0YsTUFBRCxDQUF6QjtBQUNBLGNBQU1sQixHQUFHLEdBQUcsSUFBSUMsS0FBSixDQUFVa0IsR0FBVixDQUFaO0FBQ0FuQixRQUFBQSxHQUFHLENBQUNxQixJQUFKLEdBQVdILE1BQVg7QUFDQSxjQUFNbEIsR0FBTjtBQUNEO0FBQ0YsS0FqQ21CLENBbUNwQjs7O0FBQ0EsVUFBTXNCLFVBQVUsR0FBRyxLQUFLekMsZUFBTCxDQUFxQjZCLFlBQXJCLENBQW5CO0FBQ0EsVUFBTWEsU0FBUyxHQUFHLEtBQUt6QyxhQUFMLENBQW1CNEIsWUFBbkIsQ0FBbEI7QUFDQSxVQUFNYyxPQUFPLEdBQUdDLGNBQWMsQ0FBQ2IsT0FBRCxFQUFVVyxTQUFWLEVBQXFCRCxVQUFyQixDQUE5QixDQXRDb0IsQ0F3Q3BCOztBQUNBLFVBQU1JLE9BQU8sR0FBRyxFQUFFLEdBQUdGO0FBQUwsS0FBaEI7O0FBQ0EsU0FBSyxJQUFJRyxDQUFULElBQWNILE9BQWQsRUFBdUI7QUFDckIsVUFBSUcsQ0FBQyxJQUFJLEtBQUszRSxZQUFMLENBQVQsRUFBNkI7QUFDM0IsY0FBTTRFLElBQUksR0FBRyxLQUFLNUUsWUFBTCxFQUFtQjJFLENBQW5CLENBQWI7QUFDQUQsUUFBQUEsT0FBTyxDQUFDRSxJQUFELENBQVAsR0FBZ0JKLE9BQU8sQ0FBQ0csQ0FBRCxDQUF2QjtBQUNBRCxRQUFBQSxPQUFPLENBQUNFLElBQUQsQ0FBUCxDQUFjQyxLQUFkLEdBQXNCRixDQUF0QjtBQUNBSCxRQUFBQSxPQUFPLENBQUNHLENBQUQsQ0FBUCxDQUFXQyxJQUFYLEdBQWtCQSxJQUFsQjtBQUNEO0FBQ0Y7O0FBRUQsU0FBS2hELGdCQUFMLENBQXNCOEIsWUFBdEI7QUFFQWdCLElBQUFBLE9BQU8sQ0FBQzlCLE1BQVIsR0FBaUIwQixVQUFqQjtBQUNBLFdBQU9JLE9BQVA7QUFDRDs7QUFFRFosRUFBQUEsUUFBUSxDQUFDRixPQUFELEVBQVU7QUFDaEIsUUFBSWtCLE1BQU0sR0FBRyxJQUFiO0FBRUEsUUFBSUosT0FBTyxHQUFHLEVBQWQ7QUFDQSxRQUFJSyxJQUFKO0FBQ0EsUUFBSWhCLEtBQUssR0FBRyxDQUFaOztBQUVBLFdBQU8sQ0FBQ2dCLElBQUksR0FBRyxLQUFLdEQsS0FBTCxDQUFXbUMsT0FBWCxFQUFvQkcsS0FBcEIsQ0FBUixNQUF3QyxJQUEvQyxFQUFxRDtBQUNuRFcsTUFBQUEsT0FBTyxDQUFDTSxJQUFSLENBQWFELElBQWI7QUFDQWhCLE1BQUFBLEtBQUssR0FBR2dCLElBQUksQ0FBQyxDQUFELENBQUosQ0FBUUUsR0FBaEI7QUFFQUgsTUFBQUEsTUFBTTtBQUNOLDJCQUFPQSxNQUFNLEdBQUcsQ0FBaEIsRUFBbUIsdUJBQW5CO0FBQ0Q7O0FBRUQsV0FBT0osT0FBUDtBQUNEOztBQUVEUSxFQUFBQSxhQUFhLENBQUN0QixPQUFELEVBQVV1QixXQUFWLEVBQXVCO0FBQ2xDLFdBQU8sS0FBS3pELFVBQUwsQ0FBZ0JrQyxPQUFoQixFQUF5QnVCLFdBQXpCLEVBQXNDLENBQXRDLEVBQXlDL0UsdUJBQXpDLENBQVA7QUFDRDs7QUFFRHNCLEVBQUFBLFVBQVUsQ0FBQ2tDLE9BQUQsRUFBVXVCLFdBQVYsRUFBdUJuQixXQUF2QixFQUFvQ0gsT0FBcEMsRUFBNkM7QUFDckQseUJBQU8sS0FBSy9ELE1BQUwsQ0FBUDs7QUFFQSxRQUFJa0UsV0FBVyxJQUFJSixPQUFPLENBQUNoQixNQUEzQixFQUFtQztBQUNqQyxhQUFPLElBQVA7QUFDRDs7QUFFRG9CLElBQUFBLFdBQVcsR0FBR0EsV0FBVyxJQUFJLENBQTdCO0FBQ0FILElBQUFBLE9BQU8sR0FBR0EsT0FBTyxJQUFJLENBQXJCO0FBQ0FBLElBQUFBLE9BQU8sR0FBR0EsT0FBTyxHQUFHeEQseUJBQXBCO0FBRUEsVUFBTTRELGFBQWEsR0FBR3ZCLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZaUIsT0FBWixFQUFxQixTQUFyQixDQUF0QjtBQUVBLFVBQU13QixpQkFBaUIsR0FBRzFDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZd0MsV0FBWixFQUF5QixTQUF6QixDQUExQjtBQUVBLFFBQUlFLE1BQU0sR0FBRyxHQUFiOztBQUVBLGFBQVU7QUFDUixZQUFNM0IsWUFBWSxHQUFHLEtBQUsvQixlQUFMLEVBQXJCLENBRFEsQ0FHUjs7QUFDQSxZQUFNMkQsZ0JBQWdCLEdBQUdDLElBQUksQ0FBQ0MsS0FBTCxDQUFXNUIsT0FBTyxDQUFDaEIsTUFBUixHQUFpQnlDLE1BQTVCLENBQXpCOztBQUVBLFVBQUlDLGdCQUFnQixHQUFHaEYsc0JBQXZCLEVBQStDO0FBQzdDLGVBQU9ILG9CQUFQO0FBQ0Q7O0FBRUQsWUFBTXNGLFlBQVksR0FBR3JELG9CQUFvQixDQUFDa0QsZ0JBQUQsQ0FBekM7QUFFQSxZQUFNcEIsTUFBTSxHQUFHckUsS0FBSyxDQUFDNkIsVUFBTixDQUNiLEtBQUs1QixNQUFMLENBRGEsRUFFYm1FLGFBRmEsRUFHYkEsYUFBYSxDQUFDckIsTUFBZCxHQUF1QixDQUhWLEVBSWJvQixXQUphLEVBS2JOLFlBTGEsRUFNYkcsT0FOYSxFQU9idUIsaUJBUGEsRUFRYkEsaUJBQWlCLENBQUN4QyxNQUFsQixHQUEyQixDQVJkLEVBU2I2QyxZQVRhLEVBVWJILGdCQVZhLENBQWY7O0FBWUEsVUFBSXBCLE1BQU0sR0FBRyxDQUFiLEVBQWdCO0FBQ2QsYUFBS3RDLGdCQUFMLENBQXNCOEIsWUFBdEI7O0FBRUEsWUFBSVEsTUFBTSxLQUFLL0Qsb0JBQWYsRUFBcUM7QUFDbkNOLFVBQUFBLEtBQUssQ0FBQ21CLElBQU4sQ0FBV3lFLFlBQVg7QUFDQUosVUFBQUEsTUFBTSxJQUFJLENBQVY7QUFDQTtBQUNELFNBSkQsTUFLSztBQUNIeEYsVUFBQUEsS0FBSyxDQUFDbUIsSUFBTixDQUFXeUUsWUFBWDtBQUNBLGdCQUFNdEIsR0FBRyxHQUFHQyxhQUFhLENBQUNGLE1BQUQsQ0FBekI7QUFDQSxnQkFBTWxCLEdBQUcsR0FBRyxJQUFJQyxLQUFKLENBQVVrQixHQUFWLENBQVo7QUFDQW5CLFVBQUFBLEdBQUcsQ0FBQ3FCLElBQUosR0FBV0gsTUFBWDtBQUNBLGdCQUFNbEIsR0FBTjtBQUNEO0FBQ0Y7O0FBRUQsYUFBT1gsdUJBQXVCLENBQUNvRCxZQUFELEVBQWV2QixNQUFmLENBQTlCO0FBQ0Q7QUFDRjs7QUFFRHJDLEVBQUFBLGVBQWUsQ0FBQzZCLFlBQUQsRUFBZTtBQUM1Qix5QkFBT0EsWUFBUDtBQUNBLFdBQU83RCxLQUFLLENBQUNnQyxlQUFOLENBQXNCNkIsWUFBdEIsQ0FBUDtBQUNEOztBQUVENUIsRUFBQUEsYUFBYSxDQUFDNEIsWUFBRCxFQUFlO0FBQzFCLHlCQUFPQSxZQUFQO0FBQ0EsV0FBTzdELEtBQUssQ0FBQ2lDLGFBQU4sQ0FBb0I0QixZQUFwQixDQUFQO0FBQ0Q7O0FBRUQzQixFQUFBQSxlQUFlLEdBQUc7QUFDaEIsUUFBSSxLQUFLakMsTUFBTCxNQUFpQixDQUFyQixFQUF3QjtBQUN4QixXQUFPRCxLQUFLLENBQUNrQyxlQUFOLENBQXNCLEtBQUtqQyxNQUFMLENBQXRCLENBQVA7QUFDRDs7QUFFRGtDLEVBQUFBLGlCQUFpQixHQUFHO0FBQ2xCLFFBQUksS0FBS2xDLE1BQUwsTUFBaUIsQ0FBckIsRUFBd0I7QUFDeEIsV0FBT0QsS0FBSyxDQUFDbUMsaUJBQU4sQ0FBd0IsS0FBS2xDLE1BQUwsQ0FBeEIsQ0FBUDtBQUNEOztBQUVEbUMsRUFBQUEsMEJBQTBCLEdBQUc7QUFDM0IsUUFBSSxLQUFLbkMsTUFBTCxNQUFpQixDQUFyQixFQUF3QjtBQUN4QixXQUFPRCxLQUFLLENBQUNvQywwQkFBTixDQUFpQyxLQUFLbkMsTUFBTCxDQUFqQyxDQUFQO0FBQ0Q7O0FBRURvQyxFQUFBQSxpQkFBaUIsR0FBRztBQUNsQixRQUFJLEtBQUtwQyxNQUFMLE1BQWlCLENBQXJCLEVBQXdCO0FBQ3hCLFdBQU9ELEtBQUssQ0FBQ3FDLGlCQUFOLENBQXdCLEtBQUtwQyxNQUFMLENBQXhCLENBQVA7QUFDRDs7QUFuUXVCOzs7O0FBc1ExQixTQUFTc0Msb0JBQVQsQ0FBOEJELEdBQTlCLEVBQW1DO0FBQ2pDLFNBQU90QyxLQUFLLENBQUNnQixNQUFOLENBQWFzQixHQUFHLEdBQUcsQ0FBbkIsQ0FBUDtBQUNEOztBQUVELFNBQVN1RCxnQkFBVCxDQUEwQnpFLEdBQTFCLEVBQStCa0IsR0FBL0IsRUFBb0M7QUFDbENBLEVBQUFBLEdBQUcsR0FBRzFCLGlCQUFTa0YsT0FBVCxDQUFrQjFFLEdBQUcsR0FBRyxDQUFQLElBQWFrQixHQUFHLEdBQUcsQ0FBbkIsQ0FBakIsTUFBNEMsQ0FBNUMsR0FBZ0RBLEdBQUcsR0FBRyxDQUF0RCxHQUEwREEsR0FBaEU7O0FBQ0EsUUFBTXlELGFBQWEsR0FBR25GLGlCQUFTb0YsS0FBVCxDQUFlQyxRQUFmLENBQXdCN0UsR0FBeEIsRUFBNkJBLEdBQUcsR0FBSWtCLEdBQUcsR0FBRyxDQUExQyxDQUF0Qjs7QUFDQSxTQUFPekMsWUFBWSxDQUFDcUcsTUFBYixDQUFvQkgsYUFBcEIsQ0FBUDtBQUNEOztBQUVELFNBQVN2RCx1QkFBVCxDQUFpQ3BCLEdBQWpDLEVBQXNDa0IsR0FBdEMsRUFBMkM7QUFDekMsUUFBTTZELE1BQU0sR0FBR04sZ0JBQWdCLENBQUN6RSxHQUFELEVBQU1rQixHQUFOLENBQS9CO0FBQ0F0QyxFQUFBQSxLQUFLLENBQUNtQixJQUFOLENBQVdDLEdBQVg7QUFDQSxTQUFPK0UsTUFBUDtBQUNEOztBQUVELFNBQVN2QixjQUFULENBQXdCYixPQUF4QixFQUFpQ1csU0FBakMsRUFBNEMwQixXQUE1QyxFQUF5RDtBQUN2RCxRQUFNQyxLQUFLLEdBQUcsRUFBZDs7QUFFQSxPQUFLLElBQUl2QixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHc0IsV0FBcEIsRUFBaUN0QixDQUFDLEVBQWxDLEVBQXNDO0FBQ3BDLFFBQUkxRCxHQUFHLEdBQUdzRCxTQUFTLEdBQUdJLENBQUMsR0FBRyxDQUFKLEdBQVEsQ0FBOUI7O0FBQ0EsVUFBTVosS0FBSyxHQUFHdEQsaUJBQVMwRixRQUFULENBQWtCbEYsR0FBbEIsRUFBdUIsS0FBdkIsRUFBOEIsS0FBOUIsQ0FBZDs7QUFDQSxVQUFNZ0UsR0FBRyxHQUFHeEUsaUJBQVMwRixRQUFULENBQWtCbEYsR0FBRyxHQUFHLENBQXhCLEVBQTJCLEtBQTNCLEVBQWtDLEtBQWxDLENBQVo7O0FBQ0EsVUFBTVEsS0FBSyxHQUFHbUMsT0FBTyxDQUFDd0MsU0FBUixDQUFrQnJDLEtBQWxCLEVBQXlCa0IsR0FBekIsQ0FBZDtBQUNBaUIsSUFBQUEsS0FBSyxDQUFDbEIsSUFBTixDQUFXO0FBQUVqQixNQUFBQSxLQUFGO0FBQVNrQixNQUFBQSxHQUFUO0FBQWN4RCxNQUFBQTtBQUFkLEtBQVg7QUFDRDs7QUFFRCxTQUFPeUUsS0FBUDtBQUNEOztBQUVELFNBQVM3QyxnQkFBVCxDQUEwQmdELFlBQTFCLEVBQXdDQyxPQUF4QyxFQUFpRG5ELFNBQWpELEVBQTREO0FBQzFELFFBQU0rQyxLQUFLLEdBQUcsRUFBZDs7QUFFQSxPQUFLLElBQUl2QixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHMkIsT0FBcEIsRUFBNkIzQixDQUFDLEVBQTlCLEVBQWtDO0FBQ2hDLFFBQUkxRCxHQUFHLEdBQUdvRixZQUFZLEdBQUdsRCxTQUFTLEdBQUd3QixDQUFaLEdBQWdCLENBQXpDOztBQUVBLFVBQU00QixLQUFLLEdBQUc5RixpQkFBUzBGLFFBQVQsQ0FBa0JsRixHQUFsQixFQUF1QixLQUF2QixFQUE4QixLQUE5QixDQUFkOztBQUNBLFVBQU0yRCxJQUFJLEdBQUdjLGdCQUFnQixDQUFDekUsR0FBRyxHQUFHLENBQVAsRUFBVXVGLFVBQVUsQ0FBQ3ZGLEdBQUcsR0FBRyxDQUFQLENBQXBCLENBQTdCO0FBQ0FpRixJQUFBQSxLQUFLLENBQUNLLEtBQUQsQ0FBTCxHQUFlM0IsSUFBZjtBQUNEOztBQUVELFNBQU9zQixLQUFQO0FBQ0Q7O0FBRUQsU0FBU00sVUFBVCxDQUFvQnZGLEdBQXBCLEVBQXlCO0FBQ3ZCLE1BQUlrQixHQUFHLEdBQUcsQ0FBVjs7QUFDQSxTQUFPMUIsaUJBQVMwRixRQUFULENBQWtCbEYsR0FBbEIsRUFBdUIsS0FBdkIsRUFBOEIsS0FBOUIsTUFBeUMsQ0FBaEQsRUFBbUQ7QUFDakRrQixJQUFBQSxHQUFHO0FBQ0hsQixJQUFBQSxHQUFHLElBQUksQ0FBUDtBQUNEOztBQUNELFNBQU9rQixHQUFQO0FBQ0Q7O0FBRUQsTUFBTXNFLE1BQU0sR0FBRztBQUNiLFFBQU0scUJBRE87QUFFYixRQUFNLHFCQUZPO0FBR2IsUUFBTSx1QkFITztBQUliLFFBQU0sdUJBSk87QUFLYixRQUFNLHVCQUxPO0FBTWIsUUFBTSx1QkFOTztBQU9iLFFBQU0sdUJBUE87QUFRYixRQUFNLHVCQVJPO0FBU2IsUUFBTSx1QkFUTztBQVViLFNBQU8sdUJBVk07QUFXYixTQUFPLHVCQVhNO0FBWWIsU0FBTyx3QkFaTTtBQWFiLFNBQU8sd0JBYk07QUFjYixTQUFPLHdCQWRNO0FBZWIsU0FBTyx3QkFmTTtBQWdCYixTQUFPLHdCQWhCTTtBQWlCYixTQUFPLHdCQWpCTTtBQWtCYixTQUFPLHdCQWxCTTtBQW1CYixTQUFPLHdCQW5CTTtBQW9CYixTQUFPLHdCQXBCTTtBQXFCYixTQUFPLHdCQXJCTTtBQXNCYixTQUFPLHdCQXRCTTtBQXVCYixTQUFPLHdCQXZCTTtBQXdCYixTQUFPLHdCQXhCTTtBQXlCYixTQUFPLHdCQXpCTTtBQTBCYixTQUFPLHdCQTFCTTtBQTJCYixTQUFPLHdCQTNCTTtBQTRCYixTQUFPLHdCQTVCTTtBQTZCYixTQUFPLHFCQTdCTTtBQThCYixTQUFPLHlCQTlCTTtBQStCYixTQUFPLHNCQS9CTTtBQWdDYixTQUFPLHFCQWhDTTtBQWlDYixTQUFPLHVCQWpDTTtBQWtDYixTQUFPLHVCQWxDTTtBQW1DYixTQUFPLDRCQW5DTTtBQW9DYixTQUFPLDBCQXBDTTtBQXFDYixTQUFPLHFCQXJDTTtBQXNDYixTQUFPLDRCQXRDTTtBQXVDYixTQUFPLHlCQXZDTTtBQXdDYixTQUFPLHVCQXhDTTtBQXlDYixTQUFPLHVCQXpDTTtBQTBDYixTQUFPLHVCQTFDTTtBQTJDYixTQUFPLHdCQTNDTTtBQTRDYixTQUFPLHNCQTVDTTtBQTZDYixTQUFPLDJCQTdDTTtBQThDYixTQUFPLDRCQTlDTTtBQStDYixTQUFPLHdCQS9DTTtBQWdEYixTQUFPLHNCQWhETTtBQWlEYixTQUFPLHlCQWpETTtBQWtEYixTQUFPLCtCQWxETTtBQW1EYixTQUFPLGtCQW5ETTtBQW9EYixTQUFPLHlCQXBETTtBQXFEYixTQUFPLHdCQXJETTtBQXNEYixTQUFPLHlCQXRETTtBQXVEYixTQUFPLG1CQXZETTtBQXdEYixTQUFPLDRCQXhETTtBQXlEYixTQUFPLDBCQXpETTtBQTBEYixTQUFPLDZCQTFETTtBQTJEYixTQUFPLDZCQTNETTtBQTREYixTQUFPLDRCQTVETTtBQTZEYixTQUFPLDRCQTdETTtBQThEYixTQUFPLCtCQTlETTtBQStEYixTQUFPLHVCQS9ETTtBQWdFYixTQUFPLDRCQWhFTTtBQWlFYixTQUFPLCtCQWpFTTtBQWtFYixTQUFPO0FBbEVNLENBQWY7O0FBcUVBLFNBQVNyQyxhQUFULENBQXVCRixNQUF2QixFQUErQjtBQUM3QixRQUFNRyxJQUFJLEdBQUksR0FBRUgsTUFBTyxFQUF2Qjs7QUFFQSxNQUFJRyxJQUFJLElBQUlvQyxNQUFaLEVBQW9CO0FBQ2xCLFdBQU9BLE1BQU0sQ0FBQ3BDLElBQUQsQ0FBYjtBQUNELEdBRkQsTUFHSztBQUNILFdBQU8sU0FBUDtBQUNEO0FBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbGlicGNyZTIgZnJvbSAnLi4vLi4vZGlzdC9saWJwY3JlMi5qcydcbmltcG9ydCBhc3NlcnQgZnJvbSAnYXNzZXJ0J1xuaW1wb3J0IHsgVGV4dERlY29kZXIgfSBmcm9tICd1dGlsJ1xuXG5jb25zdCB1dGYxNkRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoJ3V0Zi0xNicpXG5sZXQgaW5pdGlhbGl6ZWQgPSBmYWxzZVxuY29uc3QgY2Z1bmMgPSB7fVxuXG5jb25zdCBwdHJTeW0gPSBTeW1ib2woJ3B0cicpXG5jb25zdCBuYW1ldGFibGVTeW0gPSBTeW1ib2woJ25hbWV0YWJsZScpXG5jb25zdCBwYXR0ZXJuU3ltID0gU3ltYm9sKCdwYXR0ZXJuJylcblxuY29uc3QgUENSRTJfTk9fTUFUQ0ggPSAtMVxuY29uc3QgUENSRTJfRVJST1JfTk9NRU1PUlkgPSAtNDhcbmNvbnN0IFBDUkUyX1NVQlNUSVRVVEVfR0xPQkFMID0gMHgwMDAwMDEwMFxuY29uc3QgUENSRTJfU1VCU1RJVFVURV9FWFRFTkRFRCA9IDB4MDAwMDAyMDBcblxuY29uc3QgTUFYX09VVFBVVF9CVUZGRVJfU0laRSA9IDEgKiAxMDI0ICogMTAyNFxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQQ1JFIHtcbiAgc3RhdGljIGFzeW5jIGluaXQoKSB7XG4gICAgYXdhaXQgbGlicGNyZTIubG9hZGVkXG5cbiAgICBPYmplY3QuYXNzaWduKGNmdW5jLCB7XG4gICAgICBtYWxsb2MoYnl0ZXMpIHsgcmV0dXJuIGxpYnBjcmUyLl9tYWxsb2MoYnl0ZXMpIH0sXG4gICAgICBmcmVlKHB0cikgeyByZXR1cm4gbGlicGNyZTIuX2ZyZWUocHRyKSB9LFxuICAgICAgdmVyc2lvbjogbGlicGNyZTIuY3dyYXAoJ3ZlcnNpb24nLCAnbnVtYmVyJywgWydudW1iZXInXSksXG4gICAgICBjb21waWxlOiBsaWJwY3JlMi5jd3JhcCgnY29tcGlsZScsICdudW1iZXInLCBbJ2FycmF5JywgJ251bWJlcicsICdzdHJpbmcnXSksXG4gICAgICBkZXN0cm95Q29kZTogbGlicGNyZTIuY3dyYXAoJ2Rlc3Ryb3lDb2RlJywgbnVsbCwgWydudW1iZXInXSksXG4gICAgICBsYXN0RXJyb3JNZXNzYWdlOiBsaWJwY3JlMi5jd3JhcCgnbGFzdEVycm9yTWVzc2FnZScsICdudW1iZXInLCBbJ251bWJlcicsICdudW1iZXInXSksXG4gICAgICBsYXN0RXJyb3JPZmZzZXQ6IGxpYnBjcmUyLmN3cmFwKCdsYXN0RXJyb3JPZmZzZXQnLCAnbnVtYmVyJyksXG4gICAgICBtYXRjaDogbGlicGNyZTIuY3dyYXAoJ21hdGNoJywgJ251bWJlcicsIFsnbnVtYmVyJywgJ2FycmF5JywgJ251bWJlcicsICdudW1iZXInXSksXG4gICAgICBzdWJzdGl0dXRlOiBsaWJwY3JlMi5jd3JhcCgnc3Vic3RpdHV0ZScsICdudW1iZXInLCBbJ251bWJlcicsICdhcnJheScsICdudW1iZXInLCAnbnVtYmVyJywgJ251bWJlcicsICdudW1iZXInLCAnYXJyYXknLCAnbnVtYmVyJywgJ251bWJlcicsICdudW1iZXInXSksXG4gICAgICBjcmVhdGVNYXRjaERhdGE6IGxpYnBjcmUyLmN3cmFwKCdjcmVhdGVNYXRjaERhdGEnLCAnbnVtYmVyJywgWydudW1iZXInXSksXG4gICAgICBkZXN0cm95TWF0Y2hEYXRhOiBsaWJwY3JlMi5jd3JhcCgnZGVzdHJveU1hdGNoRGF0YScsIG51bGwsIFsnbnVtYmVyJ10pLFxuICAgICAgZ2V0T3ZlY3RvckNvdW50OiBsaWJwY3JlMi5jd3JhcCgnZ2V0T3ZlY3RvckNvdW50JywgJ251bWJlcicsIFsnbnVtYmVyJ10pLFxuICAgICAgZ2V0T3ZlY3RvclB0cjogbGlicGNyZTIuY3dyYXAoJ2dldE92ZWN0b3JQb2ludGVyJywgJ251bWJlcicsIFsnbnVtYmVyJ10pLFxuICAgICAgZ2V0Q2FwdHVyZUNvdW50OiBsaWJwY3JlMi5jd3JhcCgnZ2V0Q2FwdHVyZUNvdW50JywgJ251bWJlcicsIFsnbnVtYmVyJ10pLFxuICAgICAgZ2V0TWF0Y2hOYW1lQ291bnQ6IGxpYnBjcmUyLmN3cmFwKCdnZXRNYXRjaE5hbWVDb3VudCcsICdudW1iZXInLCBbJ251bWJlciddKSxcbiAgICAgIGdldE1hdGNoTmFtZVRhYmxlRW50cnlTaXplOiBsaWJwY3JlMi5jd3JhcCgnZ2V0TWF0Y2hOYW1lVGFibGVFbnRyeVNpemUnLCAnbnVtYmVyJywgWydudW1iZXInXSksXG4gICAgICBnZXRNYXRjaE5hbWVUYWJsZTogbGlicGNyZTIuY3dyYXAoJ2dldE1hdGNoTmFtZVRhYmxlJywgJ251bWJlcicsIFsnbnVtYmVyJ10pLFxuICAgIH0pXG5cbiAgICBpbml0aWFsaXplZCA9IHRydWVcbiAgfVxuXG4gIHN0YXRpYyB2ZXJzaW9uKCkge1xuICAgIGFzc2VydChpbml0aWFsaXplZClcbiAgICBjb25zdCBsZW4gPSBjZnVuYy52ZXJzaW9uKDApXG4gICAgY29uc3QgcHRyID0gYWxsb2NhdGVTdHJpbmdCdWZmZXIobGVuKVxuICAgIGNmdW5jLnZlcnNpb24ocHRyKVxuICAgIHJldHVybiBjb3B5QW5kRnJlZVN0cmluZ0J1ZmZlcihwdHIsIGxlbilcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHBhdHRlcm4sIGZsYWdzID0gJycpIHtcbiAgICBhc3NlcnQoaW5pdGlhbGl6ZWQpXG4gICAgY29uc3QgcGF0dGVybkJ1ZmZlciA9IEJ1ZmZlci5mcm9tKHBhdHRlcm4sICd1dGYxNmxlJylcbiAgICBjb25zdCBwdHIgPSBjZnVuYy5jb21waWxlKHBhdHRlcm5CdWZmZXIsIHBhdHRlcm5CdWZmZXIubGVuZ3RoIC8gMiwgZmxhZ3MpXG5cbiAgICBpZiAocHRyID09PSAwKSB7XG4gICAgICBjb25zdCB7IGVycm9yTWVzc2FnZSwgb2Zmc2V0IH0gPSB0aGlzLmdldExhc3RFcnJvcigpXG4gICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlKVxuICAgICAgZXJyLm9mZnNldCA9IG9mZnNldFxuICAgICAgdGhyb3cgZXJyXG4gICAgfVxuXG4gICAgdGhpc1twdHJTeW1dID0gcHRyXG4gICAgdGhpc1twYXR0ZXJuU3ltXSA9IHBhdHRlcm5cblxuICAgIC8vIGV4dHJhY3QgdGhlIG5hbWV0YWJsZSBcbiAgICBjb25zdCBuYW1lQ291bnQgPSB0aGlzLmdldE1hdGNoTmFtZUNvdW50KClcbiAgICBjb25zdCBlbnRyeVNpemUgPSB0aGlzLmdldE1hdGNoTmFtZVRhYmxlRW50cnlTaXplKClcbiAgICBjb25zdCB0YWJsZUJ1ZiA9IHRoaXMuZ2V0TWF0Y2hOYW1lVGFibGUoKVxuICAgIHRoaXNbbmFtZXRhYmxlU3ltXSA9IGNvbnZlcnROYW1lVGFibGUodGFibGVCdWYsIG5hbWVDb3VudCwgZW50cnlTaXplKVxuICB9XG5cbiAgZGVzdHJveSgpIHtcbiAgICBpZiAodGhpc1twdHJTeW1dID09PSAwKSByZXR1cm5cbiAgICBjZnVuYy5kZXN0cm95Q29kZSh0aGlzW3B0clN5bV0pXG4gICAgdGhpc1twdHJTeW1dID0gMFxuICB9XG5cbiAgZ2V0TGFzdEVycm9yKCkge1xuICAgIGNvbnN0IGVyck1zZ0J1ZkxlbiA9IDI1NlxuICAgIGNvbnN0IGVyck1zZ0J1ZiA9IGFsbG9jYXRlU3RyaW5nQnVmZmVyKGVyck1zZ0J1ZkxlbilcbiAgICBjb25zdCBhY3R1YWxFcnJNc2dMZW4gPSBjZnVuYy5sYXN0RXJyb3JNZXNzYWdlKGVyck1zZ0J1ZiwgZXJyTXNnQnVmTGVuKVxuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGNvcHlBbmRGcmVlU3RyaW5nQnVmZmVyKGVyck1zZ0J1ZiwgYWN0dWFsRXJyTXNnTGVuKVxuICAgIGNvbnN0IG9mZnNldCA9IGNmdW5jLmxhc3RFcnJvck9mZnNldCgpXG5cbiAgICByZXR1cm4geyBlcnJvck1lc3NhZ2UsIG9mZnNldCB9XG4gIH1cblxuICBjcmVhdGVNYXRjaERhdGEoKSB7XG4gICAgcmV0dXJuIGNmdW5jLmNyZWF0ZU1hdGNoRGF0YSh0aGlzW3B0clN5bV0pXG4gIH1cblxuICBkZXN0cm95TWF0Y2hEYXRhKG1hdGNoRGF0YVB0cikge1xuICAgIGNmdW5jLmRlc3Ryb3lNYXRjaERhdGEobWF0Y2hEYXRhUHRyKVxuICB9XG5cbiAgZXhlYyhzdWJqZWN0LCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiB0aGlzLm1hdGNoQWxsKHN1YmplY3QpXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMubWF0Y2goc3ViamVjdClcbiAgICB9XG4gIH1cblxuICBtYXRjaChzdWJqZWN0LCBzdGFydCkge1xuICAgIGFzc2VydCh0aGlzW3B0clN5bV0pXG5cbiAgICBpZiAoc3RhcnQgPj0gc3ViamVjdC5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgY29uc3Qgc3RhcnRPZmZzZXQgPSBzdGFydCB8fCAwXG5cbiAgICBjb25zdCBzdWJqZWN0QnVmZmVyID0gQnVmZmVyLmZyb20oc3ViamVjdCwgJ3V0ZjE2bGUnKVxuXG4gICAgY29uc3QgbWF0Y2hEYXRhUHRyID0gdGhpcy5jcmVhdGVNYXRjaERhdGEoKVxuXG4gICAgY29uc3QgcmVzdWx0ID0gY2Z1bmMubWF0Y2goXG4gICAgICB0aGlzW3B0clN5bV0sXG4gICAgICBzdWJqZWN0QnVmZmVyLFxuICAgICAgc3ViamVjdEJ1ZmZlci5sZW5ndGggLyAyLFxuICAgICAgc3RhcnRPZmZzZXQsXG4gICAgICBtYXRjaERhdGFQdHJcbiAgICApXG5cbiAgICBpZiAocmVzdWx0IDwgMCkge1xuICAgICAgdGhpcy5kZXN0cm95TWF0Y2hEYXRhKG1hdGNoRGF0YVB0cilcblxuICAgICAgaWYgKHJlc3VsdCA9PT0gUENSRTJfTk9fTUFUQ0gpIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBtc2cgPSBnZXRQQ1JFMkVycm9yKHJlc3VsdClcbiAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKG1zZylcbiAgICAgICAgZXJyLmNvZGUgPSByZXN1bHRcbiAgICAgICAgdGhyb3cgZXJyXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gZXh0cmFjdCB0aGUgbWF0Y2hlcyBmcm9tIHRoZSBwY3JlMl9tYXRjaF9kYXRhIGJsb2NrXG4gICAgY29uc3QgbWF0Y2hDb3VudCA9IHRoaXMuZ2V0T3ZlY3RvckNvdW50KG1hdGNoRGF0YVB0cilcbiAgICBjb25zdCB2ZWN0b3JQdHIgPSB0aGlzLmdldE92ZWN0b3JQdHIobWF0Y2hEYXRhUHRyKVxuICAgIGNvbnN0IG1hdGNoZXMgPSBjb252ZXJ0T1ZlY3RvcihzdWJqZWN0LCB2ZWN0b3JQdHIsIG1hdGNoQ291bnQpXG5cbiAgICAvLyBtZXJnZSBpbiBuYW1ldGFibGUgZW50cmllc1xuICAgIGNvbnN0IHJlc3VsdHMgPSB7IC4uLm1hdGNoZXMgfVxuICAgIGZvciAobGV0IGkgaW4gbWF0Y2hlcykge1xuICAgICAgaWYgKGkgaW4gdGhpc1tuYW1ldGFibGVTeW1dKSB7XG4gICAgICAgIGNvbnN0IG5hbWUgPSB0aGlzW25hbWV0YWJsZVN5bV1baV1cbiAgICAgICAgcmVzdWx0c1tuYW1lXSA9IG1hdGNoZXNbaV1cbiAgICAgICAgcmVzdWx0c1tuYW1lXS5ncm91cCA9IGlcbiAgICAgICAgbWF0Y2hlc1tpXS5uYW1lID0gbmFtZVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZGVzdHJveU1hdGNoRGF0YShtYXRjaERhdGFQdHIpXG5cbiAgICByZXN1bHRzLmxlbmd0aCA9IG1hdGNoQ291bnRcbiAgICByZXR1cm4gcmVzdWx0c1xuICB9XG5cbiAgbWF0Y2hBbGwoc3ViamVjdCkge1xuICAgIGxldCBzYWZldHkgPSAxMDAwXG5cbiAgICBsZXQgcmVzdWx0cyA9IFtdXG4gICAgbGV0IGl0ZXJcbiAgICBsZXQgc3RhcnQgPSAwXG5cbiAgICB3aGlsZSAoKGl0ZXIgPSB0aGlzLm1hdGNoKHN1YmplY3QsIHN0YXJ0KSkgIT09IG51bGwpIHtcbiAgICAgIHJlc3VsdHMucHVzaChpdGVyKVxuICAgICAgc3RhcnQgPSBpdGVyWzBdLmVuZFxuXG4gICAgICBzYWZldHktLVxuICAgICAgYXNzZXJ0KHNhZmV0eSA+IDAsICdzYWZldHkgbGltaXQgZXhjZWVkZWQnKVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRzXG4gIH1cblxuICBzdWJzdGl0dXRlQWxsKHN1YmplY3QsIHJlcGxhY2VtZW50KSB7XG4gICAgcmV0dXJuIHRoaXMuc3Vic3RpdHV0ZShzdWJqZWN0LCByZXBsYWNlbWVudCwgMCwgUENSRTJfU1VCU1RJVFVURV9HTE9CQUwpXG4gIH1cblxuICBzdWJzdGl0dXRlKHN1YmplY3QsIHJlcGxhY2VtZW50LCBzdGFydE9mZnNldCwgb3B0aW9ucykge1xuICAgIGFzc2VydCh0aGlzW3B0clN5bV0pXG5cbiAgICBpZiAoc3RhcnRPZmZzZXQgPj0gc3ViamVjdC5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgc3RhcnRPZmZzZXQgPSBzdGFydE9mZnNldCB8fCAwXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgMFxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHwgUENSRTJfU1VCU1RJVFVURV9FWFRFTkRFRFxuXG4gICAgY29uc3Qgc3ViamVjdEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKHN1YmplY3QsICd1dGYxNmxlJylcblxuICAgIGNvbnN0IHJlcGxhY2VtZW50QnVmZmVyID0gQnVmZmVyLmZyb20ocmVwbGFjZW1lbnQsICd1dGYxNmxlJylcblxuICAgIGxldCBmYWN0b3IgPSAxLjVcblxuICAgIGZvciAoOyA7KSB7XG4gICAgICBjb25zdCBtYXRjaERhdGFQdHIgPSB0aGlzLmNyZWF0ZU1hdGNoRGF0YSgpXG5cbiAgICAgIC8vIFRoaXMgc2l6ZSBpcyBpbiBjaGFyYWN0ZXIgdW5pdHMsIG5vdCBieXRlc1xuICAgICAgY29uc3Qgb3V0cHV0QnVmZmVyU2l6ZSA9IE1hdGgudHJ1bmMoc3ViamVjdC5sZW5ndGggKiBmYWN0b3IpXG5cbiAgICAgIGlmIChvdXRwdXRCdWZmZXJTaXplID4gTUFYX09VVFBVVF9CVUZGRVJfU0laRSkge1xuICAgICAgICByZXR1cm4gUENSRTJfRVJST1JfTk9NRU1PUllcbiAgICAgIH1cblxuICAgICAgY29uc3Qgb3V0cHV0QnVmZmVyID0gYWxsb2NhdGVTdHJpbmdCdWZmZXIob3V0cHV0QnVmZmVyU2l6ZSlcblxuICAgICAgY29uc3QgcmVzdWx0ID0gY2Z1bmMuc3Vic3RpdHV0ZShcbiAgICAgICAgdGhpc1twdHJTeW1dLFxuICAgICAgICBzdWJqZWN0QnVmZmVyLFxuICAgICAgICBzdWJqZWN0QnVmZmVyLmxlbmd0aCAvIDIsXG4gICAgICAgIHN0YXJ0T2Zmc2V0LFxuICAgICAgICBtYXRjaERhdGFQdHIsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgICAgIHJlcGxhY2VtZW50QnVmZmVyLFxuICAgICAgICByZXBsYWNlbWVudEJ1ZmZlci5sZW5ndGggLyAyLFxuICAgICAgICBvdXRwdXRCdWZmZXIsXG4gICAgICAgIG91dHB1dEJ1ZmZlclNpemUpXG5cbiAgICAgIGlmIChyZXN1bHQgPCAwKSB7XG4gICAgICAgIHRoaXMuZGVzdHJveU1hdGNoRGF0YShtYXRjaERhdGFQdHIpXG5cbiAgICAgICAgaWYgKHJlc3VsdCA9PT0gUENSRTJfRVJST1JfTk9NRU1PUlkpIHtcbiAgICAgICAgICBjZnVuYy5mcmVlKG91dHB1dEJ1ZmZlcilcbiAgICAgICAgICBmYWN0b3IgKj0gMlxuICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgY2Z1bmMuZnJlZShvdXRwdXRCdWZmZXIpXG4gICAgICAgICAgY29uc3QgbXNnID0gZ2V0UENSRTJFcnJvcihyZXN1bHQpXG4gICAgICAgICAgY29uc3QgZXJyID0gbmV3IEVycm9yKG1zZylcbiAgICAgICAgICBlcnIuY29kZSA9IHJlc3VsdFxuICAgICAgICAgIHRocm93IGVyclxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBjb3B5QW5kRnJlZVN0cmluZ0J1ZmZlcihvdXRwdXRCdWZmZXIsIHJlc3VsdClcbiAgICB9XG4gIH1cblxuICBnZXRPdmVjdG9yQ291bnQobWF0Y2hEYXRhUHRyKSB7XG4gICAgYXNzZXJ0KG1hdGNoRGF0YVB0cilcbiAgICByZXR1cm4gY2Z1bmMuZ2V0T3ZlY3RvckNvdW50KG1hdGNoRGF0YVB0cilcbiAgfVxuXG4gIGdldE92ZWN0b3JQdHIobWF0Y2hEYXRhUHRyKSB7XG4gICAgYXNzZXJ0KG1hdGNoRGF0YVB0cilcbiAgICByZXR1cm4gY2Z1bmMuZ2V0T3ZlY3RvclB0cihtYXRjaERhdGFQdHIpXG4gIH1cblxuICBnZXRDYXB0dXJlQ291bnQoKSB7XG4gICAgaWYgKHRoaXNbcHRyU3ltXSA9PT0gMCkgcmV0dXJuXG4gICAgcmV0dXJuIGNmdW5jLmdldENhcHR1cmVDb3VudCh0aGlzW3B0clN5bV0pXG4gIH1cblxuICBnZXRNYXRjaE5hbWVDb3VudCgpIHtcbiAgICBpZiAodGhpc1twdHJTeW1dID09PSAwKSByZXR1cm5cbiAgICByZXR1cm4gY2Z1bmMuZ2V0TWF0Y2hOYW1lQ291bnQodGhpc1twdHJTeW1dKVxuICB9XG5cbiAgZ2V0TWF0Y2hOYW1lVGFibGVFbnRyeVNpemUoKSB7XG4gICAgaWYgKHRoaXNbcHRyU3ltXSA9PT0gMCkgcmV0dXJuXG4gICAgcmV0dXJuIGNmdW5jLmdldE1hdGNoTmFtZVRhYmxlRW50cnlTaXplKHRoaXNbcHRyU3ltXSlcbiAgfVxuXG4gIGdldE1hdGNoTmFtZVRhYmxlKCkge1xuICAgIGlmICh0aGlzW3B0clN5bV0gPT09IDApIHJldHVyblxuICAgIHJldHVybiBjZnVuYy5nZXRNYXRjaE5hbWVUYWJsZSh0aGlzW3B0clN5bV0pXG4gIH1cbn1cblxuZnVuY3Rpb24gYWxsb2NhdGVTdHJpbmdCdWZmZXIobGVuKSB7XG4gIHJldHVybiBjZnVuYy5tYWxsb2MobGVuICogMilcbn1cblxuZnVuY3Rpb24gY29weVN0cmluZ0J1ZmZlcihwdHIsIGxlbikge1xuICBsZW4gPSBsaWJwY3JlMi5IRUFQVTE2WyhwdHIgLyAyKSArIChsZW4gLSAxKV0gPT09IDAgPyBsZW4gLSAxIDogbGVuXG4gIGNvbnN0IGVuY29kZWRTdHJpbmcgPSBsaWJwY3JlMi5IRUFQOC5zdWJhcnJheShwdHIsIHB0ciArIChsZW4gKiAyKSlcbiAgcmV0dXJuIHV0ZjE2RGVjb2Rlci5kZWNvZGUoZW5jb2RlZFN0cmluZylcbn1cblxuZnVuY3Rpb24gY29weUFuZEZyZWVTdHJpbmdCdWZmZXIocHRyLCBsZW4pIHtcbiAgY29uc3Qgc3RyaW5nID0gY29weVN0cmluZ0J1ZmZlcihwdHIsIGxlbilcbiAgY2Z1bmMuZnJlZShwdHIpXG4gIHJldHVybiBzdHJpbmdcbn1cblxuZnVuY3Rpb24gY29udmVydE9WZWN0b3Ioc3ViamVjdCwgdmVjdG9yUHRyLCB2ZWN0b3JDb3VudCkge1xuICBjb25zdCB0YWJsZSA9IFtdXG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB2ZWN0b3JDb3VudDsgaSsrKSB7XG4gICAgbGV0IHB0ciA9IHZlY3RvclB0ciArIGkgKiA0ICogMlxuICAgIGNvbnN0IHN0YXJ0ID0gbGlicGNyZTIuZ2V0VmFsdWUocHRyLCAnaTMyJywgZmFsc2UpXG4gICAgY29uc3QgZW5kID0gbGlicGNyZTIuZ2V0VmFsdWUocHRyICsgNCwgJ2kzMicsIGZhbHNlKVxuICAgIGNvbnN0IG1hdGNoID0gc3ViamVjdC5zdWJzdHJpbmcoc3RhcnQsIGVuZClcbiAgICB0YWJsZS5wdXNoKHsgc3RhcnQsIGVuZCwgbWF0Y2ggfSlcbiAgfVxuXG4gIHJldHVybiB0YWJsZVxufVxuXG5mdW5jdGlvbiBjb252ZXJ0TmFtZVRhYmxlKG5hbWVUYWJsZVB0ciwgZW50cmllcywgZW50cnlTaXplKSB7XG4gIGNvbnN0IHRhYmxlID0ge31cblxuICBmb3IgKGxldCBpID0gMDsgaSA8IGVudHJpZXM7IGkrKykge1xuICAgIGxldCBwdHIgPSBuYW1lVGFibGVQdHIgKyBlbnRyeVNpemUgKiBpICogMlxuXG4gICAgY29uc3QgaW5kZXggPSBsaWJwY3JlMi5nZXRWYWx1ZShwdHIsICdpMTYnLCBmYWxzZSlcbiAgICBjb25zdCBuYW1lID0gY29weVN0cmluZ0J1ZmZlcihwdHIgKyAyLCB1dGYxNmxlbGVuKHB0ciArIDIpKVxuICAgIHRhYmxlW2luZGV4XSA9IG5hbWVcbiAgfVxuXG4gIHJldHVybiB0YWJsZVxufVxuXG5mdW5jdGlvbiB1dGYxNmxlbGVuKHB0cikge1xuICBsZXQgbGVuID0gMFxuICB3aGlsZSAobGlicGNyZTIuZ2V0VmFsdWUocHRyLCAnaTE2JywgZmFsc2UpICE9PSAwKSB7XG4gICAgbGVuKytcbiAgICBwdHIgKz0gMlxuICB9XG4gIHJldHVybiBsZW5cbn1cblxuY29uc3QgRVJST1JTID0ge1xuICBcIi0xXCI6IFwiUENSRTJfRVJST1JfTk9NQVRDSFwiLFxuICBcIi0yXCI6IFwiUENSRTJfRVJST1JfUEFSVElBTFwiLFxuICBcIi0zXCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlIxXCIsXG4gIFwiLTRcIjogXCJQQ1JFMl9FUlJPUl9VVEY4X0VSUjJcIixcbiAgXCItNVwiOiBcIlBDUkUyX0VSUk9SX1VURjhfRVJSM1wiLFxuICBcIi02XCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlI0XCIsXG4gIFwiLTdcIjogXCJQQ1JFMl9FUlJPUl9VVEY4X0VSUjVcIixcbiAgXCItOFwiOiBcIlBDUkUyX0VSUk9SX1VURjhfRVJSNlwiLFxuICBcIi05XCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlI3XCIsXG4gIFwiLTEwXCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlI4XCIsXG4gIFwiLTExXCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlI5XCIsXG4gIFwiLTEyXCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlIxMFwiLFxuICBcIi0xM1wiOiBcIlBDUkUyX0VSUk9SX1VURjhfRVJSMTFcIixcbiAgXCItMTRcIjogXCJQQ1JFMl9FUlJPUl9VVEY4X0VSUjEyXCIsXG4gIFwiLTE1XCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlIxM1wiLFxuICBcIi0xNlwiOiBcIlBDUkUyX0VSUk9SX1VURjhfRVJSMTRcIixcbiAgXCItMTdcIjogXCJQQ1JFMl9FUlJPUl9VVEY4X0VSUjE1XCIsXG4gIFwiLTE4XCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlIxNlwiLFxuICBcIi0xOVwiOiBcIlBDUkUyX0VSUk9SX1VURjhfRVJSMTdcIixcbiAgXCItMjBcIjogXCJQQ1JFMl9FUlJPUl9VVEY4X0VSUjE4XCIsXG4gIFwiLTIxXCI6IFwiUENSRTJfRVJST1JfVVRGOF9FUlIxOVwiLFxuICBcIi0yMlwiOiBcIlBDUkUyX0VSUk9SX1VURjhfRVJSMjBcIixcbiAgXCItMjNcIjogXCJQQ1JFMl9FUlJPUl9VVEY4X0VSUjIxXCIsXG4gIFwiLTI0XCI6IFwiUENSRTJfRVJST1JfVVRGMTZfRVJSMVwiLFxuICBcIi0yNVwiOiBcIlBDUkUyX0VSUk9SX1VURjE2X0VSUjJcIixcbiAgXCItMjZcIjogXCJQQ1JFMl9FUlJPUl9VVEYxNl9FUlIzXCIsXG4gIFwiLTI3XCI6IFwiUENSRTJfRVJST1JfVVRGMzJfRVJSMVwiLFxuICBcIi0yOFwiOiBcIlBDUkUyX0VSUk9SX1VURjMyX0VSUjJcIixcbiAgXCItMjlcIjogXCJQQ1JFMl9FUlJPUl9CQUREQVRBXCIsXG4gIFwiLTMwXCI6IFwiUENSRTJfRVJST1JfTUlYRURUQUJMRVNcIixcbiAgXCItMzFcIjogXCJQQ1JFMl9FUlJPUl9CQURNQUdJQ1wiLFxuICBcIi0zMlwiOiBcIlBDUkUyX0VSUk9SX0JBRE1PREVcIixcbiAgXCItMzNcIjogXCJQQ1JFMl9FUlJPUl9CQURPRkZTRVRcIixcbiAgXCItMzRcIjogXCJQQ1JFMl9FUlJPUl9CQURPUFRJT05cIixcbiAgXCItMzVcIjogXCJQQ1JFMl9FUlJPUl9CQURSRVBMQUNFTUVOVFwiLFxuICBcIi0zNlwiOiBcIlBDUkUyX0VSUk9SX0JBRFVURk9GRlNFVFwiLFxuICBcIi0zN1wiOiBcIlBDUkUyX0VSUk9SX0NBTExPVVRcIixcbiAgXCItMzhcIjogXCJQQ1JFMl9FUlJPUl9ERkFfQkFEUkVTVEFSVFwiLFxuICBcIi0zOVwiOiBcIlBDUkUyX0VSUk9SX0RGQV9SRUNVUlNFXCIsXG4gIFwiLTQwXCI6IFwiUENSRTJfRVJST1JfREZBX1VDT05EXCIsXG4gIFwiLTQxXCI6IFwiUENSRTJfRVJST1JfREZBX1VGVU5DXCIsXG4gIFwiLTQyXCI6IFwiUENSRTJfRVJST1JfREZBX1VJVEVNXCIsXG4gIFwiLTQzXCI6IFwiUENSRTJfRVJST1JfREZBX1dTU0laRVwiLFxuICBcIi00NFwiOiBcIlBDUkUyX0VSUk9SX0lOVEVSTkFMXCIsXG4gIFwiLTQ1XCI6IFwiUENSRTJfRVJST1JfSklUX0JBRE9QVElPTlwiLFxuICBcIi00NlwiOiBcIlBDUkUyX0VSUk9SX0pJVF9TVEFDS0xJTUlUXCIsXG4gIFwiLTQ3XCI6IFwiUENSRTJfRVJST1JfTUFUQ0hMSU1JVFwiLFxuICBcIi00OFwiOiBcIlBDUkUyX0VSUk9SX05PTUVNT1JZXCIsXG4gIFwiLTQ5XCI6IFwiUENSRTJfRVJST1JfTk9TVUJTVFJJTkdcIixcbiAgXCItNTBcIjogXCJQQ1JFMl9FUlJPUl9OT1VOSVFVRVNVQlNUUklOR1wiLFxuICBcIi01MVwiOiBcIlBDUkUyX0VSUk9SX05VTExcIixcbiAgXCItNTJcIjogXCJQQ1JFMl9FUlJPUl9SRUNVUlNFTE9PUFwiLFxuICBcIi01M1wiOiBcIlBDUkUyX0VSUk9SX0RFUFRITElNSVRcIixcbiAgXCItNTRcIjogXCJQQ1JFMl9FUlJPUl9VTkFWQUlMQUJMRVwiLFxuICBcIi01NVwiOiBcIlBDUkUyX0VSUk9SX1VOU0VUXCIsXG4gIFwiLTU2XCI6IFwiUENSRTJfRVJST1JfQkFET0ZGU0VUTElNSVRcIixcbiAgXCItNTdcIjogXCJQQ1JFMl9FUlJPUl9CQURSRVBFU0NBUEVcIixcbiAgXCItNThcIjogXCJQQ1JFMl9FUlJPUl9SRVBNSVNTSU5HQlJBQ0VcIixcbiAgXCItNTlcIjogXCJQQ1JFMl9FUlJPUl9CQURTVUJTVElUVVRJT05cIixcbiAgXCItNjBcIjogXCJQQ1JFMl9FUlJPUl9CQURTVUJTUEFUVEVSTlwiLFxuICBcIi02MVwiOiBcIlBDUkUyX0VSUk9SX1RPT01BTllSRVBMQUNFXCIsXG4gIFwiLTYyXCI6IFwiUENSRTJfRVJST1JfQkFEU0VSSUFMSVpFRERBVEFcIixcbiAgXCItNjNcIjogXCJQQ1JFMl9FUlJPUl9IRUFQTElNSVRcIixcbiAgXCItNjRcIjogXCJQQ1JFMl9FUlJPUl9DT05WRVJUX1NZTlRBWFwiLFxuICBcIi02NVwiOiBcIlBDUkUyX0VSUk9SX0lOVEVSTkFMX0RVUE1BVENIXCIsXG4gIFwiLTY2XCI6IFwiUENSRTJfRVJST1JfREZBX1VJTlZBTElEX1VURlwiLFxufVxuXG5mdW5jdGlvbiBnZXRQQ1JFMkVycm9yKHJlc3VsdCkge1xuICBjb25zdCBjb2RlID0gYCR7cmVzdWx0fWBcblxuICBpZiAoY29kZSBpbiBFUlJPUlMpIHtcbiAgICByZXR1cm4gRVJST1JTW2NvZGVdXG4gIH1cbiAgZWxzZSB7XG4gICAgcmV0dXJuIFwiVU5LTk9XTlwiXG4gIH1cbn1cbiJdfQ==